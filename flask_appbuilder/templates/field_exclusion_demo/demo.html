{% extends "appbuilder/base.html" %}

{% block head_css %}
{{ super() }}
<style>
.exclusion-demo-card {
    margin-bottom: 1.5rem;
}

.field-type-card {
    border-left: 4px solid #dc3545;
    margin-bottom: 1rem;
}

.field-type-card.supported {
    border-left-color: #28a745;
}

.field-type-card.limited {
    border-left-color: #ffc107;
}

.field-type-list {
    font-family: monospace;
    background-color: #f8f9fa;
    padding: 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.9em;
}

.exclusion-reason {
    font-style: italic;
    color: #6c757d;
}

.operation-badge {
    margin-right: 0.5rem;
    margin-bottom: 0.25rem;
}

.demo-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
}

.stats-card {
    text-align: center;
    background-color: #f8f9fa;
    border-radius: 0.5rem;
    padding: 1.5rem;
    margin-bottom: 1rem;
}

.stats-number {
    font-size: 2rem;
    font-weight: bold;
    color: #495057;
}

.stats-label {
    color: #6c757d;
    font-size: 0.9rem;
}

.test-section {
    background-color: #e3f2fd;
    border: 1px solid #bbdefb;
    border-radius: 0.5rem;
    padding: 1.5rem;
    margin-top: 2rem;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    
    <!-- Header Section -->
    <div class="demo-header text-center">
        <h1><i class="fa fa-filter"></i> {{ title }}</h1>
        <p class="lead mb-0">{{ description }}</p>
    </div>
    
    <!-- Overview Statistics -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="stats-card">
                <div class="stats-number">{{ excluded_types|length }}</div>
                <div class="stats-label">{{ _('Excluded Type Categories') }}</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card">
                <div class="stats-number">{{ supported_operations|length }}</div>
                <div class="stats-label">{{ _('Supported Operations') }}</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card">
                <div class="stats-number">20+</div>
                <div class="stats-label">{{ _('Detected Field Types') }}</div>
            </div>
        </div>
    </div>
    
    <!-- Supported Operations -->
    <div class="row">
        <div class="col-12">
            <div class="card exclusion-demo-card">
                <div class="card-header">
                    <h4><i class="fa fa-check-circle text-success"></i> {{ _('Supported Operations') }}</h4>
                </div>
                <div class="card-body">
                    <p>{{ _('The smart exclusion system protects these operations from unsupported field types:') }}</p>
                    <div class="row">
                        {% for op_key, op_desc in supported_operations.items() %}
                        <div class="col-md-4 mb-3">
                            <div class="d-flex align-items-center">
                                <i class="fa fa-{{ 'search' if op_key == 'search' else 'filter' if op_key == 'filter' else 'list' }} text-primary me-2"></i>
                                <div>
                                    <strong>{{ op_key.title() }}</strong><br>
                                    <small class="text-muted">{{ op_desc }}</small>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Excluded Field Types -->
    <div class="row">
        <div class="col-12">
            <div class="card exclusion-demo-card">
                <div class="card-header">
                    <h4><i class="fa fa-times-circle text-danger"></i> {{ _('Automatically Excluded Field Types') }}</h4>
                </div>
                <div class="card-body">
                    <p>{{ _('These field types are automatically excluded from search and filter operations:') }}</p>
                    
                    <div class="row">
                        {% for category_key, category_info in excluded_types.items() %}
                        <div class="col-lg-6 mb-3">
                            <div class="card field-type-card">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="fa fa-exclamation-triangle text-warning"></i>
                                        {{ category_info.name }}
                                    </h6>
                                    
                                    <div class="field-type-list mb-2">
                                        {% for field_type in category_info.types %}
                                            <span class="badge bg-secondary me-1">{{ field_type }}</span>
                                        {% endfor %}
                                    </div>
                                    
                                    <p class="exclusion-reason mb-0">
                                        <i class="fa fa-info-circle"></i> {{ category_info.reason }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- How It Works -->
    <div class="row">
        <div class="col-12">
            <div class="card exclusion-demo-card">
                <div class="card-header">
                    <h4><i class="fa fa-cogs text-info"></i> {{ _('How Smart Exclusion Works') }}</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fa fa-search"></i> {{ _('Automatic Detection') }}</h6>
                            <ul>
                                <li>{{ _('Analyzes SQLAlchemy column types') }}</li>
                                <li>{{ _('Detects PostgreSQL, MySQL, and SQLite types') }}</li>
                                <li>{{ _('Identifies Flask-AppBuilder custom types') }}</li>
                                <li>{{ _('Checks for spatial and vector data') }}</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fa fa-shield-alt"></i> {{ _('Smart Protection') }}</h6>
                            <ul>
                                <li>{{ _('Prevents errors from unsupported operations') }}</li>
                                <li>{{ _('Improves performance by avoiding complex queries') }}</li>
                                <li>{{ _('Provides clear feedback on exclusions') }}</li>
                                <li>{{ _('Maintains backward compatibility') }}</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h6><i class="fa fa-wrench"></i> {{ _('Configuration Options') }}</h6>
                            <ul>
                                <li>{{ _('Strict vs. permissive mode') }}</li>
                                <li>{{ _('Custom exclusion rules') }}</li>
                                <li>{{ _('Per-view configuration') }}</li>
                                <li>{{ _('Administrative overrides') }}</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fa fa-chart-bar"></i> {{ _('Reporting & Analysis') }}</h6>
                            <ul>
                                <li>{{ _('Detailed exclusion reports') }}</li>
                                <li>{{ _('Field type analysis') }}</li>
                                <li>{{ _('Performance impact metrics') }}</li>
                                <li>{{ _('Usage recommendations') }}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Testing and Tools -->
    <div class="test-section">
        <h5><i class="fa fa-flask text-primary"></i> {{ _('Testing and Administration Tools') }}</h5>
        <p>{{ _('Explore the smart exclusion system with these administrative tools:') }}</p>
        
        <div class="row">
            <div class="col-md-4">
                <div class="d-grid">
                    <a href="{{ url_for('FieldExclusionDemoView.list_models') }}" class="btn btn-outline-primary">
                        <i class="fa fa-database"></i> {{ _('Analyze Models') }}
                    </a>
                </div>
                <small class="text-muted d-block mt-2">{{ _('Analyze field types in your database models') }}</small>
            </div>
            <div class="col-md-4">
                <div class="d-grid">
                    <a href="{{ url_for('FieldExclusionDemoView.exclusion_report') }}" class="btn btn-outline-info">
                        <i class="fa fa-chart-pie"></i> {{ _('Exclusion Report') }}
                    </a>
                </div>
                <small class="text-muted d-block mt-2">{{ _('Generate comprehensive exclusion reports') }}</small>
            </div>
            <div class="col-md-4">
                <div class="d-grid">
                    <a href="{{ url_for('FieldExclusionDemoView.test_exclusion') }}" class="btn btn-outline-success">
                        <i class="fa fa-vial"></i> {{ _('Test Field Types') }}
                    </a>
                </div>
                <small class="text-muted d-block mt-2">{{ _('Interactive testing of field type exclusions') }}</small>
            </div>
        </div>
    </div>
    
    <!-- Usage Example -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fa fa-code text-success"></i> {{ _('Usage Example') }}</h4>
                </div>
                <div class="card-body">
                    <p>{{ _('Enable smart exclusion in your Flask-AppBuilder views:') }}</p>
                    
                    <pre><code># Simple usage with mixin
class MyModelView(SmartExclusionMixin, ModelView):
    datamodel = SQLAInterface(MyModel)
    # search_columns will be automatically configured

# Or use the decorator
@apply_smart_exclusion(strict_mode=True)
class MyEnhancedView(ModelView):
    datamodel = SQLAInterface(MyModel)

# Direct configuration
class MyCustomView(ModelView):
    datamodel = SQLAInterface(MyModel)
    
    def __init__(self):
        super().__init__()
        self.search_columns = self.get_smart_search_columns()
</code></pre>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fa fa-lightbulb"></i>
                        <strong>{{ _('Pro Tip') }}:</strong>
                        {{ _('The system automatically detects and excludes unsupported field types while preserving your existing configuration for supported fields.') }}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</div>
{% endblock %}

{% block tail_js %}
{{ super() }}
<script>
// Add smooth scrolling for internal links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Add tooltips to badges
document.querySelectorAll('.badge').forEach(badge => {
    badge.setAttribute('title', 'Field type: ' + badge.textContent);
    badge.setAttribute('data-bs-toggle', 'tooltip');
});

// Initialize Bootstrap tooltips if available
if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
}
</script>
{% endblock %}