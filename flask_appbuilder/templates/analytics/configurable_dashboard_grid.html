{% extends "appbuilder/base.html" %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>{{ dashboard_config.get('title', 'Dashboard') }}</h2>
        <div class="btn-group">
            <a href="{{ url_for('DashboardLayoutView.form') }}" class="btn btn-primary btn-sm">
                <i class="fa fa-cog"></i> Configure
            </a>
            <button id="refreshDashboard" class="btn btn-secondary btn-sm">
                <i class="fa fa-refresh"></i> Refresh
            </button>
        </div>
    </div>

    <!-- Grid Layout -->
    <div class="row" id="dashboardGrid">
        {% for widget in widgets %}
        <div class="col-lg-{{ widget.grid_size or 6 }} col-md-12 mb-4">
            <div class="card h-100">
                {% if widget.show_header %}
                <div class="card-header">
                    <h5 class="card-title mb-0">{{ widget.title }}</h5>
                </div>
                {% endif %}
                <div class="card-body">
                    {{ widget.content|safe }}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if not widgets %}
    <div class="row">
        <div class="col-12">
            <div class="alert alert-info text-center">
                <h4><i class="fa fa-info-circle"></i> No Widgets Configured</h4>
                <p>Your dashboard is empty. <a href="{{ url_for('DashboardLayoutView.form') }}">Configure widgets</a> to get started.</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Auto-refresh functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const refreshBtn = document.getElementById('refreshDashboard');
    const autoRefresh = {{ dashboard_config.get('auto_refresh', false)|lower }};
    const refreshInterval = {{ dashboard_config.get('refresh_interval', 300) * 1000 }};
    
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            location.reload();
        });
    }
    
    // Auto-refresh if enabled
    if (autoRefresh && refreshInterval > 0) {
        setInterval(function() {
            location.reload();
        }, refreshInterval);
    }
});
</script>
{% endblock %}